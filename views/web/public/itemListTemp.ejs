<div ng-controller='PostListController'>
   <div infinite-scroll='demo.nextPage()' infinite-scroll-disabled='demo.busy' infinite-scroll-distance='1'>
   <div ng-repeat='item in demo.items'>

       <div class="blog-list-item">
           <div class="row">
               <div class="col-md-12">
                   <a href="###" target="_blank" class="item-title">{{item.title}}</a>
                   {{item.price}}
               </div>
           </div>
           <div class="row">
               <div class="col-md-3">
                   <div class="item-Img">
                       <a target="_blank" href="/detail/{{item._id}}.html">
                           <img class="img-responsive" alt="{{item.title}}" src="{{item.thumbSrc}}"></a>
                   </div>
               </div>
               <div class="col-md-9">
                   <div class="item-des">
                       <div class="item-time">
                           <span><i class="icon-time"></i><a>{{item.gmtCreated}}</a></span>
                       </div>
                       <div class="item-time">
                           <span>标签：{{item.tags}}</span>
                       </div>
                       <div class="summary">{{item.detail}}</div>
                   </div>
                   <div class="item-more">
                       <span><i class="icon-eye-open"></i><a>163</a></span>
                       <span><i class="icon-comment"></i><a>33</a></span>
                       <span><i class="icon-heart"></i><a>2</a></span>

                    <span class="glyphicon glyphicon-flag" title="列表推荐">
                        {{item.from}}
                        <a href="{{item.buyUrl}}" target="_blank" class="btn-buy" rel="nofollow"
                           style="text-align: center" _hover-ignore="1">直达链接 &gt;</a>
                    </span>
                   </div>
               </div>
           </div>
       </div>
                </div>
                <div ng-show='demo.busy'>Loading data...</div>
            </div>
     </div>


<script>
    var indexAppModule = angular.module('indexApp', ['infinite-scroll']);

    indexAppModule.controller('PostListController',
            function ($scope, Demo) {
                $scope.demo = new Demo();
            });

    // 创建后台数据交互工厂
    indexAppModule.factory('Demo', function ($http) {
        var Demo = function () {
            this.items = [];
            this.busy = false;
            this.after = '';
            this.page = 0;
        };

        Demo.prototype.nextPage = function () {
            if (this.busy) return;
            this.busy = true;

            var url = "/getProductList?callback=JSON_CALLBACK&limit=20&currentPage="+this.page;
            $http.get(url).success(function (data) {
                var items = data["docs"];
                for (var i = 0; i < items.length; i++) {
                    this.items.push(items[i]);
                }
                this.after = "t3_" + this.items[this.items.length - 1]._id;
                this.busy = false;
                this.page += 1;
            }.bind(this));
        };
        return Demo;
    });
</script>


